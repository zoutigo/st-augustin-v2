exports.id=50,exports.ids=[50],exports.modules={29089:(e,r,s)=>{let a={"1f96e3711361f4aba41371b1c913723c129b8bc4":()=>Promise.resolve().then(s.bind(s,22678)).then(e=>e.$$ACTION_0),f815a11758cd702a75f8d84d1f0704891d2df299:()=>Promise.resolve().then(s.bind(s,22678)).then(e=>e.login)};async function t(e,...r){return(await a[e]()).apply(null,r)}e.exports={"1f96e3711361f4aba41371b1c913723c129b8bc4":t.bind(null,"1f96e3711361f4aba41371b1c913723c129b8bc4"),f815a11758cd702a75f8d84d1f0704891d2df299:t.bind(null,"f815a11758cd702a75f8d84d1f0704891d2df299")}},60108:(e,r,s)=>{"use strict";s.d(r,{U:()=>h});var a=s(10326),t=s(33071),i=s(26438),l=s.n(i),n=s(77863);let o=({label:e})=>(0,a.jsxs)("div",{className:"w-full flex flex-col items-center justify-center gap-y-4",children:[(0,a.jsxs)("h1",{className:(0,n.cn)("font-semibold  text-3xl",l().className),children:[" ","\uD83D\uDD10 Auth"]}),(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",children:[e," "]})]});var d=s(98618),c=s(35047),u=s(98223),m=s(90772),f=s(83765);let p=()=>{(0,f.x)(),(0,c.useSearchParams)().get("callbackUrl");let e=e=>{(0,d.zB)(e,{callbackUrl:"/client"})};return a.jsx("div",{className:"flex items-center w-full gap-x-2",children:a.jsx(m.z,{size:"lg",variant:"outline",className:"w-full",onClick:()=>e("google"),children:a.jsx(u.JM8,{className:"h-5 w-5"})})})};var g=s(90434);let w=({label:e,href:r})=>a.jsx(m.z,{variant:"link",className:"font-normal w-full",size:"sm",asChild:!0,children:(0,a.jsxs)(g.default,{href:r,children:[e," "]})}),h=({children:e,headerLabel:r,backButtonHref:s,backButtonLabel:i,showSocial:l})=>(0,a.jsxs)(t.Zb,{className:"w-[400px] shadow-md",children:[a.jsx(t.Ol,{children:a.jsx(o,{label:r})}),a.jsx(t.aY,{children:e}),l&&a.jsx(t.eW,{children:a.jsx(p,{})}),a.jsx(t.eW,{children:a.jsx(w,{label:i,href:s})})]})},1566:(e,r,s)=>{"use strict";s.d(r,{LoginForm:()=>u});var a=s(10326),t=s(17577),i=s(74723),l=s(74064),n=s(60108),o=s(58762);s(15424),(0,s(46242).$)("f815a11758cd702a75f8d84d1f0704891d2df299");var d=s(35047),c=s(83765);let u=()=>{(0,c.x)(),(0,d.useSearchParams)().get("callbackUrl");let[e,r]=(0,t.useTransition)(),[s,u]=(0,t.useState)(),[m,f]=(0,t.useState)();return(0,i.cI)({resolver:(0,l.F)(o.pj),defaultValues:{email:"",password:""}}),a.jsx(n.U,{headerLabel:"Welcome Back",backButtonLabel:"Vous allez decouvrir de belles choses",backButtonHref:"/auth/register",showSocial:!0,children:"Its time to login !!"})}},33071:(e,r,s)=>{"use strict";s.d(r,{Ol:()=>n,Zb:()=>l,aY:()=>o,eW:()=>d});var a=s(10326),t=s(17577),i=s(77863);let l=t.forwardRef(({className:e,...r},s)=>a.jsx("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));l.displayName="Card";let n=t.forwardRef(({className:e,...r},s)=>a.jsx("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...r}));n.displayName="CardHeader",t.forwardRef(({className:e,...r},s)=>a.jsx("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r})).displayName="CardTitle",t.forwardRef(({className:e,...r},s)=>a.jsx("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...r})).displayName="CardDescription";let o=t.forwardRef(({className:e,...r},s)=>a.jsx("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...r}));o.displayName="CardContent";let d=t.forwardRef(({className:e,...r},s)=>a.jsx("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...r}));d.displayName="CardFooter"},58762:(e,r,s)=>{"use strict";s.d(r,{A3:()=>i,Tu:()=>n,Ty:()=>o,pj:()=>l});var a=s(94007),t=s(27256);let i=t.Ry({email:t.Z_({invalid_type_error:"must be an email"}).email({message:"Email is required"})});t.Ry({password:t.Z_().min(6,{message:"Minimum of 6 characters required"})});let l=t.Ry({email:t.Z_({invalid_type_error:"must be an email"}).email({message:"Email is required"}),password:t.Z_().min(1,{message:"Password is required"})}),n=t.Ry({email:t.Z_().email(),password:t.Z_().min(6,{message:"Minimum 6 characters required"}),name:t.Z_().min(1,{message:"Name is required"})}),o=t.Ry({name:t.jt(t.Z_()),grade:t.Km([a.UserGrade.ADMIN,a.UserGrade.MANAGER,a.UserGrade.MODERATOR,a.UserGrade.NONE]),email:t.jt(t.Z_().email()),password:t.jt(t.Z_().min(6)),newPassword:t.jt(t.Z_().min(6))}).refine(e=>!!e.password||!e.newPassword,{message:"New password is requeried",path:["password"]}).refine(e=>!e.password||!!e.newPassword,{message:"New password is requeried",path:["newPassword"]})},22678:(e,r,s)=>{"use strict";s.r(r),s.d(r,{$$ACTION_0:()=>u,login:()=>c});var a=s(27745);s(26461);var t=s(79779),i=s(73978),l=s(33713),n=s(58585),o=s(73922),d=s(85723);let c=(0,a.registerServerReference)("1f96e3711361f4aba41371b1c913723c129b8bc4",u);async function u(e,r){let s=t.LoginSchema.safeParse(e);if(!s.success)return{error:"Invalid fields"};let{email:a,password:d}=s.data,c=await (0,o.getUserByEmail)(a);if(!c||!c.email||!c.password)return{error:"Email does not exist"};try{await (0,l.signIn)("credentials",{email:a,password:d,redirectTo:r||n.DEFAULT_LOGIN_REDIRECT})}catch(e){if(e instanceof i.AuthError)switch(e.type){case"CallbackRouteError":case"CredentialsSignin":case"AccessDenied":return{error:"invalid credentials"};default:return{error:"Something went wrong"}}throw e}}(0,d.ensureServerEntryExports)([c]),(0,a.registerServerReference)("f815a11758cd702a75f8d84d1f0704891d2df299",c)},61273:(e,r,s)=>{"use strict";s.d(r,{default:()=>u});var a=s(90396),t=s(11250),i=s(52909),l=s(74987),n=s.n(l),o=s(79779),d=s(73922),c=s(10692);let u={providers:[(0,a.default)({clientId:process.env.AUTH_FACEBOOK_ID,clientSecret:process.env.AUTH_FACEBOOK_SECRET}),(0,t.default)({clientId:process.env.AUTH_GOOGLE_ID,clientSecret:process.env.AUTH_GOOGLE_SECRET}),(0,i.default)({name:"credentials",credentials:{email:{},password:{}},authorize:async e=>{console.log("Log 1: D\xe9but de l'autorisation");let r=o.LoginSchema.safeParse(e);if(console.log("Log 2: Champs valid\xe9s",r),r.success){let{email:e,password:s}=r.data;console.log("Log 3: Champs extraits",{email:e,password:s});try{let r=await (0,d.getUserByEmail)(e);if(console.log("Log 4: Utilisateur trouv\xe9",r),!r||!r.password)return console.log("Log 5: Utilisateur non trouv\xe9 ou sans mot de passe"),null;let a=await n().compare(s,r.password);if(console.log("Log 6: Comparaison des mots de passe",a),a)return console.log("Log 7: Mot de passe correspondant"),r;return console.log("Log 8: Mot de passe incorrect"),null}catch(e){if(console.log("Log 9: Erreur dans le bloc try",e),e instanceof c.ZodError)return console.log("Log 10: Erreur de validation Zod",e),null;throw console.log("Log 11: Autre erreur",e),e}}throw console.log("Log 12: Champs invalides"),Error("Invalid input")}})]}},33713:(e,r,s)=>{"use strict";s.d(r,{auth:()=>m,signIn:()=>c,signOut:()=>u});var a=s(73978),t=s(91873),i=s(61273),l=s(88296),n=s(73922),o=s(36567);let{handlers:d,signIn:c,signOut:u,auth:m}=(0,a.default)({adapter:(0,t.PrismaAdapter)(l.db),pages:{signIn:"/auth/login",error:"/auth/error"},events:{async linkAccount({user:e}){await l.db.user.update({where:{id:e.id},data:{emailVerified:new Date}})}},callbacks:{async signIn({user:e,account:r}){if(r?.provider!=="credentials"){let s=await (0,n.getUserByEmail)(e.email);s&&!await l.db.account.findFirst({where:{provider:r?.provider,providerAccountId:r?.providerAccountId,userId:s.id}})&&await l.db.account.create({data:{userId:s.id,provider:r?.provider,providerAccountId:r?.providerAccountId,type:r?.type,access_token:r?.access_token,token_type:r?.token_type,scope:r?.scope,id_token:r?.id_token,session_state:r?.session_state,expires_at:r?.expires_at,refresh_token:r?.refresh_token}})}return!0},session:async({session:e,token:r})=>(r.sub&&e.user&&(e.user.id=r.sub),r.role&&e.user&&(e.user.role=r.role,e.user.grade=r.role),e.user&&(e.user.name=r.name,e.user.email=r.email,e.user.isOAuth=r.isOAuth),e),async jwt({token:e}){if(!e.sub)return e;let r=await (0,n.getUserById)(e.sub);if(!r)return e;let s=await (0,o.getAccountByUserId)(r.id);return e.isOAuth=!!s,e.name=r.name,e.email=r.email,e.role=r.role,e}},session:{strategy:"jwt"},...i.default})},36567:(e,r,s)=>{"use strict";s.d(r,{getAccountByUserId:()=>t});var a=s(88296);let t=async e=>{try{return await a.db.account.findFirst({where:{userId:e}})}catch(e){return null}}},58585:(e,r,s)=>{"use strict";s.d(r,{DEFAULT_LOGIN_REDIRECT:()=>a});let a="/settings"}};