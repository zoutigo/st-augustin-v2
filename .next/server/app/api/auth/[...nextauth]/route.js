"use strict";(()=>{var e={};e.id=912,e.ids=[912],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},97463:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c});var t={};s.r(t),s.d(t,{GET:()=>n,POST:()=>u});var a=s(49303),o=s(88716),i=s(60670);let{GET:n,POST:u}=s(4050).handlers,l=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/[...nextauth]/route",pathname:"/api/auth/[...nextauth]",filename:"route",bundlePath:"app/api/auth/[...nextauth]/route"},resolvedPagePath:"/home/zoutigo/projets/nextjs/ecole-st-augustin-v2/app/api/auth/[...nextauth]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:p}=l,m="/api/auth/[...nextauth]/route";function g(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:c})}},4050:(e,r,s)=>{s.d(r,{I8:()=>f,handlers:()=>v});var t=s(66096),a=s(7585),o=s(72178),i=s(8204),n=s(80772),u=s(42023),l=s.n(u),d=s(53524),c=s(7410);c.Ry({email:c.Z_({invalid_type_error:"must be an email"}).email({message:"Email is required"})}),c.Ry({password:c.Z_().min(6,{message:"Minimum of 6 characters required"})});let p=c.Ry({email:c.Z_({invalid_type_error:"must be an email"}).email({message:"Email is required"}),password:c.Z_().min(1,{message:"Password is required"})});c.Ry({email:c.Z_().email(),password:c.Z_().min(6,{message:"Minimum 6 characters required"}),name:c.Z_().min(1,{message:"Name is required"})}),c.Ry({name:c.jt(c.Z_()),grade:c.Km([d.UserGrade.ADMIN,d.UserGrade.MANAGER,d.UserGrade.MODERATOR,d.UserGrade.NONE]),email:c.jt(c.Z_().email()),password:c.jt(c.Z_().min(6)),newPassword:c.jt(c.Z_().min(6))}).refine(e=>!!e.password||!e.newPassword,{message:"New password is requeried",path:["password"]}).refine(e=>!e.password||!!e.newPassword,{message:"New password is requeried",path:["newPassword"]});let m=globalThis.prismaGlobal??new d.PrismaClient,g=async e=>{try{return await m.user.findUnique({where:{email:e}})}catch{return null}},h=async e=>{try{return await m.user.findUnique({where:{id:e}})}catch{return null}},w={providers:[(0,o.Z)({clientId:process.env.AUTH_FACEBOOK_ID,clientSecret:process.env.AUTH_FACEBOOK_SECRET}),(0,i.Z)({clientId:process.env.AUTH_GOOGLE_ID,clientSecret:process.env.AUTH_GOOGLE_SECRET}),(0,n.Z)({name:"credentials",credentials:{email:{},password:{}},authorize:async e=>{console.log("Log 1: D\xe9but de l'autorisation");let r=p.safeParse(e);if(console.log("Log 2: Champs valid\xe9s",r),r.success){let{email:e,password:s}=r.data;console.log("Log 3: Champs extraits",{email:e,password:s});try{let r=await g(e);if(console.log("Log 4: Utilisateur trouv\xe9",r),!r||!r.password)return console.log("Log 5: Utilisateur non trouv\xe9 ou sans mot de passe"),null;let t=await l().compare(s,r.password);if(console.log("Log 6: Comparaison des mots de passe",t),t)return console.log("Log 7: Mot de passe correspondant"),r;return console.log("Log 8: Mot de passe incorrect"),null}catch(e){if(console.log("Log 9: Erreur dans le bloc try",e),e instanceof c.jm)return console.log("Log 10: Erreur de validation Zod",e),null;throw console.log("Log 11: Autre erreur",e),e}}throw console.log("Log 12: Champs invalides"),Error("Invalid input")}})]},_=async e=>{try{return await m.account.findFirst({where:{userId:e}})}catch(e){return null}},{handlers:v,signIn:x,signOut:y,auth:f}=(0,t.ZP)({adapter:(0,a.N)(m),pages:{signIn:"/auth/login",error:"/auth/error"},events:{async linkAccount({user:e}){await m.user.update({where:{id:e.id},data:{emailVerified:new Date}})}},callbacks:{async signIn({user:e,account:r}){if(r?.provider!=="credentials"){let s=await g(e.email);s&&!await m.account.findFirst({where:{provider:r?.provider,providerAccountId:r?.providerAccountId,userId:s.id}})&&await m.account.create({data:{userId:s.id,provider:r?.provider,providerAccountId:r?.providerAccountId,type:r?.type,access_token:r?.access_token,token_type:r?.token_type,scope:r?.scope,id_token:r?.id_token,session_state:r?.session_state,expires_at:r?.expires_at,refresh_token:r?.refresh_token}})}return!0},session:async({session:e,token:r})=>(r.sub&&e.user&&(e.user.id=r.sub),r.role&&e.user&&(e.user.role=r.role,e.user.grade=r.role),e.user&&(e.user.name=r.name,e.user.email=r.email,e.user.isOAuth=r.isOAuth),e),async jwt({token:e}){if(!e.sub)return e;let r=await h(e.sub);if(!r)return e;let s=await _(r.id);return e.isOAuth=!!s,e.name=r.name,e.email=r.email,e.role=r.role,e}},session:{strategy:"jwt"},...w})},49303:(e,r,s)=>{e.exports=s(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[948,927],()=>s(97463));module.exports=t})();